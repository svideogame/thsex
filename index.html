<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video.js Encrypted Video Player - Dynamic Slideshow Top</title>

    <link id="vjs-css" href="https://vjs.zencdn.net/8.6.0/video-js.css" rel="stylesheet" />

    <style>
        /* ------------------------------------------- */
        /* BASE LAYOUT */
        /* ------------------------------------------- */
        body { 
            font-family: sans-serif; 
            display: flex; 
            flex-direction: column; 
            justify-content: flex-start; 
            align-items: center; 
            min-height: 100vh; 
            background-color: #111; 
            padding: 20px 0;
            color: white;
        }
        .player-container { 
            width: 800px; 
            max-width: 95%; 
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.5); 
            background-color: #000;
        }

        /* ------------------------------------------- */
        /* â­ï¸ æ’­æ”¾å™¨ä¸Šæ–¹çš„æ»šåŠ¨å›¾åº“æ ·å¼ â­ï¸ */
        /* ------------------------------------------- */
        #slideshow-wrapper {
        width: 800px; 
        max-width: 95%;
        
        /* â­ï¸ æ ¸å¿ƒæ”¹åŠ¨ 1: ä½¿ç”¨ padding-top åˆ›å»º 21:9 å“åº”å¼æ¯”ä¾‹é«˜åº¦ */
        padding-top: 42.86%; /* (9 / 21) * 100% â‰ˆ 42.86% */
        height: 0; /* ç¡®ä¿ padding-top æ§åˆ¶é«˜åº¦ */
        
        margin-bottom: 20px; 
        overflow: hidden;
        position: relative;
        box-shadow: 0 0 15px rgba(255, 255, 255, 0.1);
        background-color: #000;
        display: none; 
        border-radius: 8px;
        }
        #slideshow-title {
            position: absolute;
            
            /* â­ï¸ æ ¸å¿ƒæ”¹åŠ¨ï¼šç§»è‡³å·¦ä¸Šè§’ï¼Œå¹¶å¢åŠ è¾¹è· */
            top: 20px;          /* è·ç¦»é¡¶éƒ¨ 20px */
            left: 20px;         /* è·ç¦»å·¦ä¾§ 20px */
            transform: none;    /* ç§»é™¤åŸæœ‰çš„æ°´å¹³å±…ä¸­å˜æ¢ */
            
            color: #ff0000;
            font-size: 1.2rem;
            font-weight: bold;
            z-index: 10;
            
            /* è°ƒæ•´èƒŒæ™¯å’Œå†…è¾¹è·ï¼Œä½¿å…¶æ›´æ¸…æ™° */
            background-color: rgba(0, 0, 0, 0.7); /* å¢åŠ èƒŒæ™¯é€æ˜åº¦ï¼Œæ›´æ˜“è¯» */
            padding: 5px 12px; 
            border-radius: 4px;
            
            /* â­ï¸ ä¼˜åŒ–ï¼šé˜²æ­¢æ–‡å­—è¿‡é•¿æ—¶æº¢å‡ºå’Œè¦†ç›–å›¾ç‰‡ â­ï¸ */
            max-width: 70%; /* é™åˆ¶æœ€å¤§å®½åº¦ */
            white-space: nowrap; /* å¼ºåˆ¶ä¸æ¢è¡Œ */
            overflow: hidden; /* éšè—æº¢å‡ºå†…å®¹ */
            text-overflow: ellipsis; /* æº¢å‡ºæ—¶æ˜¾ç¤ºçœç•¥å· */
        }
        /* ------------------------------------------- */
/* â­ï¸ å¹»ç¯ç‰‡é€Ÿåº¦æ§åˆ¶æ¡æ ·å¼ â­ï¸ */
/* ------------------------------------------- */
        #slideshow-container {
            /* ç»§æ‰¿åŸæœ‰çš„ç»å¯¹å®šä½å’Œå¡«å…… */
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;

            /* æ ¸å¿ƒæ”¹åŠ¨ï¼šä½¿ç”¨ Flexbox å®ç°æ§åˆ¶æ¡å’Œå†…å®¹å¹¶æ’ */
            display: flex;
            justify-content: flex-start; /* æ§åˆ¶æ¡åœ¨å·¦ä¾§ */
            align-items: flex-start;
        }

        .controls-panel {
            /* æ§åˆ¶é¢æ¿çš„å®¹å™¨æ ·å¼ */
            width: 100px; /* å›ºå®šçš„å®½åº¦ */
            height: 100%; /* å¡«å……é«˜åº¦ */
            display: flex;
            flex-direction: column; /* å†…éƒ¨å…ƒç´ å‚ç›´æ’åˆ— */
            align-items: center;
            background-color: rgba(0, 0, 0, 0.5); /* åŠé€æ˜èƒŒæ™¯ï¼ŒåŒºåˆ†å†…å®¹ */
            padding: 10px 0;
            box-sizing: border-box;
            z-index: 20; /* ç¡®ä¿åœ¨å›¾ç‰‡ä¹‹ä¸Š */
            border-right: 1px solid rgba(255, 255, 255, 0.1);
        }

        .controls-panel h3 {
            margin: 5px 0 10px 0;
            font-size: 1rem;
            color: #fff;
            font-weight: normal;
        }

        /* â­ï¸ ä¼˜åŒ–åçš„æ»‘å—æ ·å¼ â­ï¸ */
        /* â­ï¸ ä¼˜åŒ–åçš„æ»‘å—æ ·å¼ â­ï¸ */
        #slideSpeed {
            -webkit-appearance: none;
            /* æ ¸å¿ƒä¿®æ”¹ 1: å®½åº¦è°ƒæ•´ä¸ºå°äºç­‰äºçˆ¶å®¹å™¨çš„å®½åº¦ (100px) */
            width: 80px; /* æ—‹è½¬åçš„â€œé«˜åº¦â€ä¸º 80pxï¼Œç•™å‡º 20px è¾¹è· */
            height: 20px;
            
            /* æ ¸å¿ƒä¿®æ”¹ 2: ç§»é™¤åŸæ¥çš„ marginï¼Œæˆ‘ä»¬ç”¨å®šä½å’Œ transform å±…ä¸­ */
            margin: 0; /* ç§»é™¤åŸæ¥çš„ margin */
            
            /* æ ¸å¿ƒä¿®æ”¹ 3: ä½¿ç”¨æ›´ç²¾ç¡®çš„å±…ä¸­æ—‹è½¬ */
            transform: rotate(270deg) translateY(0px); /* æ—‹è½¬ 270 åº¦ï¼Œä¸è¿›è¡Œé¢å¤–Yè½´å¹³ç§» */
            transform-origin: 50% 50%;
            
            z-index: 20;
            
            /* æ ¸å¿ƒä¿®æ”¹ 4: ç›¸å¯¹å®šä½ï¼Œå¾®è°ƒä½ç½®åˆ°ä¸­å¿ƒ */
            /* æ—‹è½¬åï¼Œå®ƒåœ¨çˆ¶å®¹å™¨ä¸­çœ‹èµ·æ¥æ˜¯å‚ç›´çš„ã€‚
            width: 80px çš„æ—‹è½¬å…ƒç´ ï¼Œåœ¨ 100px çš„çˆ¶å®¹å™¨ä¸­ï¼Œå±…ä¸­åå·¦å³å„æœ‰ 10px è¾¹è·ã€‚
            æ— éœ€é¢å¤–çš„ top/left è°ƒæ•´ï¼Œåªè¦ä¿è¯çˆ¶å®¹å™¨ `.controls-panel` å†…éƒ¨æ˜¯å±…ä¸­å¯¹é½å³å¯ã€‚
            å› ä¸º `.controls-panel` è®¾ç½®äº† `align-items: center;`ï¼Œ`width: 80px` çš„æ»‘å—ä¼šè‡ªåŠ¨æ°´å¹³å±…ä¸­ã€‚
            */
        }

        /* è½¨é“æ ·å¼ */
        #slideSpeed::-webkit-slider-runnable-track {
            width: 100%;
            height: 8px;
            cursor: pointer;
            background: #444;
            border-radius: 4px;
        }

        /* æ»‘å—æ ·å¼ */
        #slideSpeed::-webkit-slider-thumb {
            -webkit-appearance: none;
            height: 18px;
            width: 18px;
            border-radius: 50%;
            background: #ff0000; /* ä½¿ç”¨æ‚¨çš„ä¸»é¢˜è‰² */
            cursor: pointer;
            margin-top: -5px; 
        }

        #speedDisplay {
            font-size: 1.3em;
            font-weight: bold;
            color: #ffcc00;
        }
        /* ------------------------------------------- */
        #slideshow-image {
            width: 100%;
            height: 100%;
            /* â­ï¸ æ ¸å¿ƒæ”¹åŠ¨ï¼šä» cover æ”¹ä¸º contain â­ï¸ */
            object-fit: contain;
            position: absolute;
            top: 0;
            left: 0;
            opacity: 0;
            transition: opacity 1s ease-in-out; /* å›¾ç‰‡æ·¡å…¥æ·¡å‡ºæ•ˆæœ */
            filter: brightness(0.9); /* ç•¥å¾®å˜æš—ï¼Œçªå‡ºæ ‡é¢˜ */
        }
        #slideshow-image.active {
            opacity: 1;
        }

        /* ------------------------------------------- */
        /* Video å’Œ Wrapper (å°é¢å›¾å’Œæ¨¡ç³Š) */
        /* ------------------------------------------- */
        #video-wrapper {
            position: relative; 
            background-color: black; 
            width: 100%;
            padding-top: 56.25%; /* 16:9 Aspect Ratio */
            overflow: hidden; 
            
            /* é™æ€å°é¢å›¾ç‰‡è·¯å¾„ */
            background-image: url('video/cover_image.jpg'); 
            background-size: cover; 
            background-repeat: no-repeat;
            background-position: center center; 
            transition: background-image 0.5s ease-in-out; 
        }
        
        /* è§†é¢‘æ’­æ”¾æ—¶ï¼Œç§»é™¤èƒŒæ™¯ */
        #video-wrapper[data-active="true"] {
            background-image: none !important;
        }
        /* åˆå§‹/æ’­æ”¾å¤±è´¥æ—¶ï¼Œæ¢å¤é™æ€èƒŒæ™¯ */
        #video-wrapper[data-active="false"] {
            background-image: url('video/cover_image.jpg'); 
        }

        /* â­ï¸ æ ¸å¿ƒæ–°å¢ï¼šå½“è§†é¢‘æ­£åœ¨åŠ è½½æ—¶ï¼Œå¢åŠ æ¨¡ç³Šå±‚çš„æš—åº¦ â­ï¸ */
        #video-wrapper[data-loading="true"]::before {
            background-color: rgba(0, 0, 0, 0.85); /* æ˜æ˜¾å˜æš—ï¼Œçªå‡ºè¿›åº¦æ¡å’Œæ–‡å­— */
        }

        /* æ’­æ”¾æˆåŠŸåï¼Œå°†å…¶è®¾ä¸ºå‡ ä¹é€æ˜ï¼Œåªä¿ç•™æ¨¡ç³Š */
        #video-wrapper[data-active="true"]::before {
            background-color: rgba(0, 0, 0, 0.0);
        }

        /* æ¨¡ç³ŠèƒŒæ™¯å±‚ (z-index: 1) */
        #video-wrapper::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 1; 
            background-color: rgba(0, 0, 0, 0.4); 
            filter: blur(8px); 
            -webkit-backdrop-filter: blur(8px); 
            margin: -20px;
            padding: 20px;
        }
        
        /* Video.js æ’­æ”¾å™¨æ ·å¼ (z-index: 2) */
        #my-video {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            display: block;
            z-index: 2; 
        }

        /* ------------------------------------------- */
        /* å¯åŠ¨è¦†ç›–å±‚ (æŒ‰é’®å’Œè¿›åº¦æ¡) (z-index: 10) */
        /* ------------------------------------------- */
        .overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: none; 
            display: flex; 
            justify-content: center; 
            align-items: center; 
            flex-direction: column; 
            z-index: 10; /* æœ€é«˜å±‚ */
            cursor: pointer;
            opacity: 1;
        }
        .overlay-content {
            display: flex;
            flex-direction: column;
            align-items: center;
            width: 100%; 
            z-index: 11; 
        }
        
        #overlay-title {
            color: #ffcc00; 
            font-size: clamp(1.5rem, 4vw, 2.5rem);
            text-shadow: 0 0 15px rgba(255, 0, 0, 1); 
            margin-bottom: 20px; 
            font-weight: 900;
            text-align: center;
            opacity: 0.8;
            z-index: 11;
        }
        #start-btn {
            padding: 15px 40px;
            font-size: 1.5rem;
            font-weight: bold;
            background-color: #ff0000; 
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            box-shadow: 0 0 20px rgba(255, 0, 0, 0.8); 
            transition: transform 0.2s, background-color 0.2s, opacity 0.2s; 
            text-transform: uppercase;
            z-index: 11;
            opacity: 0.8; 
        }
        #start-btn:hover:not(:disabled) {
            background-color: #cc0000;
            transform: scale(1.05);
            opacity: 1;
        }
        #start-btn:disabled {
            background-color: #555;
            cursor: default;
            box-shadow: none;
            opacity: 1;
        }
        /* è¿›åº¦æ¡æ ·å¼ */
        #video-gallery h2{
        /* ä½¿ç”¨æ‚¨åŸæ¥çš„ H2 é†’ç›®é¢œè‰²å’Œæ•ˆæœ */
        color: #ffcc00; 
        font-size: clamp(1.5rem, 4vw, 2.5rem);
        text-shadow: 0 0 15px rgba(255, 0, 0, 1); 
        font-weight: 900;
        
        /* å¢åŠ ä¸Šä¸‹è¾¹è·ä½¿å…¶ä¸ç´§è´´ç€ç”»å»Š */
        margin: 0 0 25px 0; 
        padding-top: 15px; 
        text-align: center;
    }
        #loading-progress-container {
            width: 80%;
            max-width: 400px;
            height: 15px;
            background-color: rgba(255, 255, 255, 0.2);
            border-radius: 8px;
            overflow: hidden;
            margin-top: 20px;
            box-shadow: 0 0 5px rgba(0, 0, 0, 0.5);
            display: none; 
            z-index: 11;
        }
        #loading-progress-bar {
            height: 100%;
            width: 0%;
            background-color: #00ff00; 
            transition: width 0.1s linear; 
            border-radius: 8px;
        }
        #loading-status {
            color: #fff;
            margin-top: 10px;
            font-size: 1rem;
            text-shadow: 0 0 5px #000;
            min-height: 1.2em;
            z-index: 11;
        }
        
        /* ... å…¶ä»–æ ·å¼ä¿æŒä¸å˜ ... */
        .custom-controls-bar {
            padding: 10px;
            background-color: #222; 
            text-align: right;
            border-top: 1px solid #444;
            display: none; 
        }
        #download-video-btn {
            font-size: 1rem;
            padding: 5px 15px;
            color: #28a745; 
            border: 2px solid #28a745;
            border-radius: 4px;
            background-color: #444;
            transition: all 0.2s;
            cursor: pointer;
        }
        #download-video-btn:hover {
            background-color: #28a745;
            color: white;
        }
        #download-video-btn:disabled {
            opacity: 0.5;
            cursor: default;
            background-color: #444;
            color: #28a745;
        }

        .modal {
            display: none; 
            position: fixed; 
            z-index: 100; 
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            overflow: auto; 
            background-color: rgba(0,0,0,0.8); 
            justify-content: center;
            align-items: center;
        }
        .modal-content {
            background-color: #222;
            padding: 30px;
            border: 1px solid #555;
            width: 80%;
            max-width: 400px;
            border-radius: 10px;
            text-align: center;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.5);
        }
        .modal-content input[type="password"] {
             width: calc(100% - 20px);
            padding: 10px;
            margin: 10px 0;
            box-sizing: border-box;
            border: 1px solid #444;
            border-radius: 4px;
            background-color: #333;
            color: white;
            font-size: 1rem;
        }
        .modal-content button {
            background-color: #007bff;
            color: white;
            padding: 10px 20px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            margin-top: 10px;
            transition: background-color 0.2s;
        }
        .modal-content button:hover {
            background-color: #0056b3;
        }
        #modal-message {
            color: #ffcc00;
            margin-top: 10px;
            height: 1.5em;
            font-size: 0.9rem;
        }

        /* è§†é¢‘ç”»å»Šæ ·å¼ä¿æŒä¸å˜ */
        #video-gallery {
            width: 800px; 
            max-width: 95%;
            margin-top: 30px;
            text-align: center;
        }
        #video-gallery h3 {
             font-size: 1.2rem;
             color: #aaa;
             margin-top: 10px;
        }
        #thumbnail-list {
            display: flex;
            justify-content: center;
            flex-wrap: wrap;
            gap: 15px;
            padding: 10px;
        }
        .thumbnail-item {
            width: 160px; 
            cursor: pointer;
            border: 3px solid transparent;
            border-radius: 5px;
            overflow: hidden;
            transition: border-color 0.2s, opacity 0.2s;
            opacity: 0.7;
        }
        .thumbnail-item:hover {
            opacity: 1;
            border-color: #ff0000;
        }
        .thumbnail-item.active {
            opacity: 1;
            border-color: #ffcc00; 
        }
        .thumbnail-item img {
            width: 100%;
            height: auto;
            display: block;
        }
        .thumbnail-item p {
            font-size: 0.9rem;
            margin: 5px 0 0;
            color: #ccc;}
        /* æ–°å¢ï¼šå¯¼èˆªæŒ‰é’®å®¹å™¨æ ·å¼ */
        #slideshow-controls {
            position: absolute;
            bottom: 15px; /* è·ç¦»åº•éƒ¨è¾¹ç¼˜ */
            right: 15px;  /* è·ç¦»å³ä¾§è¾¹ç¼˜ */
            z-index: 20; /* ç¡®ä¿åœ¨å›¾ç‰‡å’Œæ ‡é¢˜ä¹‹ä¸Š */
            display: flex; /* æ–¹ä¾¿æŒ‰é’®æ’åˆ— */
            gap: 10px;
        }

        /* å¯¼èˆªæŒ‰é’®é€šç”¨æ ·å¼ */
        #slideshow-controls button {
            padding: 8px 15px;
            background-color: rgba(0, 0, 0, 0.7); /* åŠé€æ˜èƒŒæ™¯ */
            color: white;
            font-size: 0.9rem;
            font-weight: bold;
            border: 1px solid rgba(255, 255, 255, 0.3);
            border-radius: 4px;
            cursor: pointer;
            transition: background-color 0.2s, border-color 0.2s;
            user-select: none; /* é˜²æ­¢åŒå‡»é€‰ä¸­æ–‡å­— */
        }

        #slideshow-controls button:hover {
            background-color: rgba(255, 0, 0, 0.8); /* æ‚¬åœæ—¶çªå‡ºæ˜¾ç¤º */
            border-color: #ff0000;
        }
        #slideshow-controls button:disabled {
            opacity: 0.5;
            cursor: default;
        }
        
    </style>
</head>
<body>

    <div id="slideshow-wrapper">
        <h3 id="slideshow-title">âœ¨Your waitressâœ¨</h3>
        <div id="slideshow-container">
            <div class="controls-panel">
                    <h3>é€Ÿåº¦æ§åˆ¶</h3>
                    <input type="range" id="slideSpeed" min="1" max="20" value="5" step="1">
                    <div id="speedDisplay">5s</div>
                    <p style="font-size: 0.8em; color: #666;">æ‹–æ‹½æ»‘å—æ¥æ”¹å˜é€Ÿåº¦</p>
                </div>
            </div>
            <div id="slideshow-controls">
        <button id="prev-slide-btn">â® Prev</button>
        <button id="next-slide-btn">Next â¯</button>
    </div>
    </div>

    <div class="player-container">
        <div id="video-wrapper" data-active="false">
            <video 
                id="my-video" 
                class="video-js vjs-default-skin vjs-big-play-centered" 
                preload="auto" 
                poster="video/cover_image.jpg" 
                data-setup='{}'>
            </video>
            
            <div id="play-overlay" class="overlay">
                <div class="overlay-content">
                    
                    <button id="start-btn">â–¶ Have funâ¤ï¸</button>
                    <div id="loading-progress-container">
                        <div id="loading-progress-bar"></div>
                    </div>
                    <p id="loading-status"></p>
                </div>
            </div>
        </div>
        
        <div class="custom-controls-bar" id="custom-controls-bar">
            <button id="download-video-btn" disabled>Download â¬‡</button>
        </div>
    </div>
    
    <div id="download-modal" class="modal">
        <div class="modal-content">
            
            <h3>Download Access Required</h3>
            <p>
                Enter your unique access key to download the decrypted video file. 
                <br>
                <a href="https://yourdomain.com/get-access-key" target="_blank" style="color: #ffcc00; text-decoration: none; font-weight: bold;">[Click here to get a key]</a>
            </p> 
            <input type="password" id="modal-password-input" placeholder="Enter Access Key">
            <button id="modal-verify-btn">Submit Key</button>
            <p id="modal-message"></p>
        </div>
    </div>

    <div id="video-gallery">
        <h2 id="overlay-title">ğŸ”¥ Exclusive Content: Click to Unlock ğŸ”¥</h2> 
        <h3>More Content</h3>
        <div id="thumbnail-list">
        </div>
    </div>

    <script>
        // ----------------------------------------------------
        // Configuration
        // ----------------------------------------------------
        const HEADER_LENGTH = 9; 
        const PASSBOOK_FILE_PATH = "data/passbook.txt"; 
        const PASSBOOK_HEADER_LENGTH = 1000; 
        const VIDEOJS_CDN = "https://vjs.zencdn.net/8.6.0/video.min.js"; 
        
        // â­ï¸ æ ¸å¿ƒé…ç½®: è§†é¢‘åˆ—è¡¨ â­ï¸
        const videoList = [
            { 
                title: "Video #1: Multi-Part Episode", 
                parts: ['video/Jordan Carver - The Locker_part1.mp4', 'video/Jordan Carver - The Locker_part2.mp4', 'video/Jordan Carver - The Locker_part3.mp4', 'video/Jordan Carver - The Locker_part4.mp4', 'video/Jordan Carver - The Locker_part5.mp4', 'video/Jordan Carver - The Locker_part6.mp4', 'video/Jordan Carver - The Locker_part7.mp4', 'video/Jordan Carver - The Locker_part8.mp4', 'video/Jordan Carver - The Locker_part9.mp4', 'video/Jordan Carver - The Locker_part10.mp4', 'video/Jordan Carver - The Locker_part11.mp4', 'video/Jordan Carver - The Locker_part12.mp4', 'video/Jordan Carver - The Locker_part13.mp4', 'video/Jordan Carver - The Locker_part14.mp4', 'video/Jordan Carver - The Locker_part15.mp4', 'video/Jordan Carver - The Locker_part16.mp4', 'video/Jordan Carver - The Locker_part17.mp4', 'video/Jordan Carver - The Locker_part18.mp4', 'video/Jordan Carver - The Locker_part19.mp4', 'video/Jordan Carver - The Locker_part20.mp4', 'video/Jordan Carver - The Locker_part21.mp4', 'video/Jordan Carver - The Locker_part22.mp4', 'video/Jordan Carver - The Locker_part23.mp4', 'video/Jordan Carver - The Locker_part24.mp4', 'video/Jordan Carver - The Locker_part25.mp4', 'video/Jordan Carver - The Locker_part26.mp4'],
                thumbnail: 'video/thumb1.jpg' 
            },
            { 
                title: "Video #2: Sneak Peak (Single Part)", 
                parts: ['video/obfuscated_video2.mp4'], 
                thumbnail: 'video/thumb2.jpg' 
            },
            { 
                title: "Video #3: Best Moments (Single Part)", 
                parts: ['video/obfuscated_video3.mp4'], 
                thumbnail: 'video/thumb3.jpg' 
            }
        ];
        
        // â­ï¸ æ–°å¢ï¼šæ¸…å•æ–‡ä»¶è·¯å¾„ â­ï¸
        const SLIDESHOW_MANIFEST_PATH = 'photos/slideshow_manifest.json';
        async function fetchSlideshowImages() {
        try {
            const response = await fetch(SLIDESHOW_MANIFEST_PATH);
            if (!response.ok) {
                console.error(`Failed to load slideshow manifest file: ${SLIDESHOW_MANIFEST_PATH}`);
                slideshowImages = []; 
                return;
            }
            const filenames = await response.json();
            
            // æ‹¼æ¥å®Œæ•´çš„è·¯å¾„ï¼š 'photos/' + æ–‡ä»¶å
            slideshowImages = filenames.map(filename => `photos/${filename}`);
            console.log(`Loaded ${slideshowImages.length} slideshow images from manifest.`);

            // â­ï¸ æ ¸å¿ƒæ”¹åŠ¨ï¼šåŠ è½½åç«‹å³éšæœºæ‰“ä¹±å›¾ç‰‡åˆ—è¡¨ â­ï¸
            shuffleArray(slideshowImages); 
            
            console.log(`Loaded and shuffled ${slideshowImages.length} slideshow images from manifest.`);
            
        } catch (error) {
            console.error("Error processing slideshow manifest:", error);
            slideshowImages = []; 
            alert("Error: Failed to process slideshow manifest file. Check JSON format.");
        }
    }
        let slideshowImages = []; // â­ï¸ æ”¹ä¸º letï¼Œå¹¶åˆå§‹åŒ–ä¸ºç©º â­ï¸

        let currentVideoIndex = 0;
        let currentVideoBlobURL = null; 
        let cachedPassbook = null; 
        let videoPlayer = null; 
        let videoJsLoaded = false; 
        let slideshowInterval = null; 

        // DOM Element Retrieval 
        const videoElement = document.getElementById('my-video');
        const videoWrapper = document.getElementById('video-wrapper');
        const playOverlay = document.getElementById('play-overlay');
        const startButton = document.getElementById('start-btn');
        const thumbnailListDiv = document.getElementById('thumbnail-list');
        const downloadVideoBtn = document.getElementById('download-video-btn');
        const customControlsBar = document.getElementById('custom-controls-bar'); 
        const downloadModal = document.getElementById('download-modal');
        const modalPasswordInput = document.getElementById('modal-password-input');
        const modalVerifyBtn = document.getElementById('modal-verify-btn');
        const modalMessage = document.getElementById('modal-message');
        
        // è¿›åº¦æ¡ DOM å…ƒç´  
        const progressBarContainer = document.getElementById('loading-progress-container');
        const progressBar = document.getElementById('loading-progress-bar');
        const loadingStatus = document.getElementById('loading-status');
        
        // æ»šåŠ¨å›¾åº“ DOM å…ƒç´ 
        const slideshowWrapper = document.getElementById('slideshow-wrapper');
        const slideshowContainer = document.getElementById('slideshow-container');
        // â­ï¸ æ–°å¢ï¼šå¯¼èˆªæŒ‰é’® DOM å…ƒç´ è·å– â­ï¸
        const prevSlideBtn = document.getElementById('prev-slide-btn');
        const nextSlideBtn = document.getElementById('next-slide-btn');

        // â­ï¸ æ–°å¢ï¼šé€Ÿåº¦æ§åˆ¶æ¡ DOM å…ƒç´ è·å– â­ï¸
        const speedSlider = document.getElementById('slideSpeed');
        const speedDisplay = document.getElementById('speedDisplay');

        /* ------------------------------------------- */
        /* â­ï¸ æ»šåŠ¨å›¾åº“é€»è¾‘ â­ï¸ */
        /* ------------------------------------------- */
        let currentSlideIndex = 0;

        function updateSlide(newIndex) {
                // ç¡®ä¿ç´¢å¼•åœ¨æœ‰æ•ˆèŒƒå›´å†…
                newIndex = (newIndex % slideshowImages.length + slideshowImages.length) % slideshowImages.length;

                const oldImg = document.getElementById('slideshow-image');
                if (oldImg) {
                    oldImg.classList.remove('active');
                }

                currentSlideIndex = newIndex;
                const newImg = document.createElement('img');
                newImg.id = 'slideshow-image';
                newImg.src = slideshowImages[currentSlideIndex];
                
                // ç”±äº object-fit: containï¼Œéœ€è¦ç¡®ä¿ position å±æ€§
                newImg.style.position = 'absolute';
                newImg.style.top = '0';
                newImg.style.left = '0';

                slideshowContainer.appendChild(newImg); 

                // å»¶è¿Ÿæ·»åŠ  active ç±»ä»¥è§¦å‘ CSS è¿‡æ¸¡ (æ·¡å…¥æ•ˆæœ)
                setTimeout(() => newImg.classList.add('active'), 50); 
                
                // ç§»é™¤æ—§çš„å›¾ç‰‡
                if (oldImg) {
                    setTimeout(() => oldImg.remove(), 1000); 
                }
            }

            function manualChangeSlide(direction) {
                if (slideshowImages.length === 0) return;

                // 1. æ¸…é™¤å½“å‰è‡ªåŠ¨æ’­æ”¾å®šæ—¶å™¨
                clearInterval(slideshowInterval);

                // 2. è®¡ç®—æ–°ç´¢å¼•
                const nextIndex = currentSlideIndex + direction;
                updateSlide(nextIndex);
                
                // 3. é‡å¯è‡ªåŠ¨æ’­æ”¾å®šæ—¶å™¨
                slideshowInterval = setInterval(nextSlide, 3000); 
            }

            function nextSlide() {
                const nextIndex = (currentSlideIndex + 1) % slideshowImages.length;
                updateSlide(nextIndex);
            }
        /**
         * å¯åŠ¨æ»šåŠ¨å›¾åº“ï¼Œåœ¨è§†é¢‘åŠ è½½æ—¶æä¾›åŠ¨æ€èƒŒæ™¯ã€‚
         */
        function startSlideshow() {
            if (slideshowImages.length === 0) return;
            
            // ç¡®ä¿æ»šåŠ¨å›¾åº“æ˜¾ç¤º
            slideshowWrapper.style.display = 'block'; 
            
            clearInterval(slideshowInterval);

            // ç¡®ä¿å®¹å™¨ä¸­æœ‰å›¾ç‰‡å…ƒç´ 
            let img = document.getElementById('slideshow-image');
            if (!img) {
                img = document.createElement('img');
                img.id = 'slideshow-image';
                slideshowContainer.appendChild(img);
            }
            img.src = slideshowImages[currentSlideIndex];
            img.classList.add('active');
            
            // åˆ‡æ¢å›¾ç‰‡é€»è¾‘
            function nextSlide() {
                const oldImg = document.getElementById('slideshow-image');
                if (oldImg) {
                    oldImg.classList.remove('active');
                }

                currentSlideIndex = (currentSlideIndex + 1) % slideshowImages.length;
                const newImg = document.createElement('img');
                newImg.id = 'slideshow-image';
                newImg.src = slideshowImages[currentSlideIndex];
                
                // ç«‹å³æ·»åŠ ï¼Œä½†è®¾ä¸ºé€æ˜
                slideshowContainer.appendChild(newImg); 

                // å»¶è¿Ÿæ·»åŠ  active ç±»ä»¥è§¦å‘ CSS è¿‡æ¸¡ (æ·¡å…¥æ•ˆæœ)
                setTimeout(() => newImg.classList.add('active'), 50); 
                
                // ç§»é™¤æ—§çš„å›¾ç‰‡
                if (oldImg) {
                    setTimeout(() => oldImg.remove(), 1000); 
                }
            }

            // æ¯ 3 ç§’åˆ‡æ¢ä¸€æ¬¡å›¾ç‰‡
            // 1. è·å–æ»‘å—çš„å½“å‰å€¼ï¼ˆç§’ï¼‰
            const currentSpeedSeconds = parseInt(speedSlider.value, 10);
            const intervalMs = currentSpeedSeconds * 1000;
            
            // 2. ä½¿ç”¨æ»‘å—çš„å€¼è®¾ç½®åˆ‡æ¢é—´éš”
            slideshowInterval = setInterval(nextSlide, intervalMs); 
            console.log(`Slideshow started with interval: ${intervalMs}ms`);
        }

        /**
         * åœæ­¢æ»šåŠ¨å›¾åº“ï¼Œåœ¨è§†é¢‘å¼€å§‹æ’­æ”¾æˆ–åŠ è½½å®Œæˆæ—¶è°ƒç”¨ã€‚
         */
        function stopSlideshow() {
            clearInterval(slideshowInterval);
            slideshowWrapper.style.display = 'none';
            // æ¸…ç†å†…éƒ¨å›¾ç‰‡ï¼Œä¸ºä¸‹æ¬¡å¯åŠ¨åšå‡†å¤‡
            slideshowContainer.innerHTML = ''; 
        }
        /* ------------------------------------------- */
        /* ------------------------------------------- */


        /* --- 0. åŠ¨æ€åŠ è½½ Video.js è„šæœ¬ --- */
        function loadVideoJsScript(callback) {
            if (videoJsLoaded) {
                callback();
                return;
            }
            const script = document.createElement('script');
            script.src = VIDEOJS_CDN;
            script.onload = () => {
                videoJsLoaded = true;
                callback();
            };
            script.onerror = () => {
                console.error("Failed to load Video.js script.");
                alert("Error loading video player. Please check your connection.");
            };
            document.body.appendChild(script);
        }

        /* --- 1. æ ¸å¿ƒé€»è¾‘: åˆ†å—ä¸‹è½½ï¼Œå»å¤´ï¼Œç²˜åˆæ’­æ”¾ --- */
        async function loadAndPlay(index) {
            if (!videoPlayer) {
                startButton.textContent = `â³ Loading Player...`;
                startButton.disabled = true;
                loadVideoJsScript(() => {
                    initializeVideoPlayer();
                    loadAndPlay(index); 
                });
                return;
            }

            currentVideoIndex = index;
            const videoData = videoList[index];
            const partsToFetch = videoData.parts; 

            // é‡Šæ”¾æ—§çš„ Blob URL èµ„æº
            if (currentVideoBlobURL) { 
                URL.revokeObjectURL(currentVideoBlobURL);
                currentVideoBlobURL = null; 
                videoPlayer.pause(); 
            }
            
            // UI çŠ¶æ€è®¾ç½® (è¿›åº¦æ¡å¯åŠ¨)
            startButton.style.display = 'none';
            progressBarContainer.style.display = 'block';
            progressBar.style.width = '0%';
            loadingStatus.textContent = `å‡†å¤‡ä¸‹è½½ ${videoData.title} (å…± ${partsToFetch.length} éƒ¨åˆ†)...`;

            startButton.disabled = true;
            playOverlay.style.cursor = 'wait';
            playOverlay.style.display = 'flex'; 
            downloadVideoBtn.disabled = true; 
            customControlsBar.style.display = 'none'; 

            updateActiveThumbnail(index);
            
            // â­ï¸ åœ¨å¼€å§‹åŠ è½½æ—¶ï¼Œå¯åŠ¨ä¸Šæ–¹çš„æ»šåŠ¨å›¾åº“ â­ï¸
            startSlideshow();
            // ç§»é™¤ data-active å±æ€§ï¼Œç¡®ä¿é™æ€å°é¢èƒŒæ™¯å¯è§ï¼Œç­‰å¾…åŠ è½½å®Œæˆ
            videoWrapper.setAttribute('data-active', 'false'); 
            // â­ï¸ æ ¸å¿ƒæ–°å¢ï¼šå¯åŠ¨åŠ è½½æ—¶ï¼Œè®¾ç½® data-loading="true" â­ï¸
            videoWrapper.setAttribute('data-loading', 'true');
            // ç¡®ä¿ active æ˜¯ false
            videoWrapper.setAttribute('data-active', 'false');

            try {
                const decryptedChunks = []; 
                let totalDecryptedLength = 0;
                let totalDownloadedBytes = 0;
                
                // 1. é¢„ä¼°æ€»å¤§å°
                const partPromises = partsToFetch.map(path => fetch(path, { method: 'HEAD' }));
                const partHeaders = await Promise.all(partPromises);
                const partLengths = partHeaders.map(h => parseInt(h.headers.get('content-length'), 10) || 0);
                const totalRawSize = partLengths.reduce((sum, size) => sum + size, 0);

                // 2. å¾ªç¯ä¸‹è½½æ¯ä¸ªåˆ†å—
                for (let i = 0; i < partsToFetch.length; i++) {
                    const partPath = partsToFetch[i];
                    
                    const response = await fetch(partPath);
                    if (!response.ok || !response.body) {
                        throw new Error(`HTTP Error for part ${i+1}: ${response.status}`);
                    }
                    
                    const reader = response.body.getReader();
                    const partChunks = [];
                    let partDownloadedBytes = 0;
                    
                    const previousDownloadedSize = partLengths.slice(0, i).reduce((sum, size) => sum + size, 0);

                    while (true) {
                        const { done, value } = await reader.read();
                        
                        if (done) {
                            break;
                        }

                        partChunks.push(value);
                        partDownloadedBytes += value.length;
                        totalDownloadedBytes = previousDownloadedSize + partDownloadedBytes; 

                        // å®æ—¶æ›´æ–°è¿›åº¦æ¡
                        if (totalRawSize > 0) {
                            const progressPercent = Math.round((totalDownloadedBytes / totalRawSize) * 100);
                            progressBar.style.width = `${progressPercent}%`;
                            loadingStatus.textContent = `Part ${i + 1}/${partsToFetch.length} (${progressPercent}%)`;
                        }
                    }

                    // åˆå¹¶å½“å‰åˆ†å—çš„æ‰€æœ‰ ArrayBuffer
                    let partBufferLength = 0;
                    partChunks.forEach(chunk => partBufferLength += chunk.length);
                    const partBuffer = new Uint8Array(partBufferLength);
                    let offset = 0;
                    partChunks.forEach(chunk => {
                        partBuffer.set(chunk, offset);
                        offset += chunk.length;
                    });
                    
                    // 3. æ ¸å¿ƒè§£å¯† (å»å¤´) é€»è¾‘
                    if (partBuffer.byteLength < HEADER_LENGTH) {
                        throw new Error(`Part ${i+1} too small.`);
                    }
                    const cleanPartBuffer = partBuffer.slice(HEADER_LENGTH); 

                    decryptedChunks.push(cleanPartBuffer);
                    totalDecryptedLength += cleanPartBuffer.length;
                } // å¾ªç¯ç»“æŸ

                // 4. å°†æ‰€æœ‰è§£å¯†åçš„åˆ†å—åˆå¹¶æˆä¸€ä¸ªå®Œæ•´çš„ ArrayBuffer (ç²˜åˆ)
                loadingStatus.textContent = 'æ‰€æœ‰åˆ†å—ä¸‹è½½å®Œæˆ, æ­£åœ¨ç²˜åˆ...';
                progressBar.style.width = '100%';
                
                const finalBuffer = new Uint8Array(totalDecryptedLength);
                let finalOffset = 0;
                decryptedChunks.forEach(chunk => {
                    finalBuffer.set(chunk, finalOffset);
                    finalOffset += chunk.length;
                });

                // 5. åˆ›å»º Blob å¹¶æ’­æ”¾
                const videoBlob = new Blob([finalBuffer], { type: 'video/mp4' });
                const videoURL = URL.createObjectURL(videoBlob);
                
                currentVideoBlobURL = videoURL; 
                
                videoPlayer.controls(true); 

                videoPlayer.src({
                    src: videoURL,
                    type: 'video/mp4' 
                });
                
                // åŠ è½½å®Œæˆåæ¸…ç†è¿›åº¦æ¡
                progressBarContainer.style.display = 'none';
                loadingStatus.textContent = 'åŠ è½½æˆåŠŸ, æ­£åœ¨æ’­æ”¾...'; 
                
                // â­ï¸ æ ¸å¿ƒä¿®æ”¹ï¼šåŠ è½½æˆåŠŸåï¼Œç§»é™¤ data-loading â­ï¸
                videoWrapper.removeAttribute('data-loading');
                // â­ï¸ åœæ­¢ä¸Šæ–¹çš„æ»šåŠ¨å›¾åº“ â­ï¸
                stopSlideshow();


                videoPlayer.ready(() => {
                    playOverlay.style.display = 'none'; 
                    
                    // â­ï¸ æˆåŠŸæ’­æ”¾æ—¶ï¼Œè®¾ç½® data-active="true"ï¼Œéšè—å°é¢èƒŒæ™¯å’Œæ¨¡ç³Šå±‚ â­ï¸
                    videoWrapper.setAttribute('data-active', 'true');
                    
                    customControlsBar.style.display = 'block'; 
                    downloadVideoBtn.disabled = false; 
                    
                    videoPlayer.play().catch(error => {
                        console.log("Autoplay blocked. User intervention required.");
                    });
                });
                    
            } catch (error) {
                // â­ï¸ æ ¸å¿ƒä¿®æ”¹ï¼šåŠ è½½å¤±è´¥åï¼Œç§»é™¤ data-loading â­ï¸
                videoWrapper.removeAttribute('data-loading');
                // é”™è¯¯å¤„ç†é€»è¾‘
                console.error("[ERROR] Video loading failed:", error.message);
                
                progressBarContainer.style.display = 'none';
                loadingStatus.textContent = ''; 
                startButton.textContent = `âŒ Loading Failed (${videoData.title}), Click to Retry`;
                startButton.style.display = 'block'; 
                
                startButton.disabled = false;
                playOverlay.style.cursor = 'pointer';
                downloadVideoBtn.disabled = true;
                customControlsBar.style.display = 'none';
                
                // â­ï¸ å¤±è´¥æ—¶ï¼Œåœæ­¢æ»šåŠ¨å›¾åº“ï¼Œå¹¶æ¢å¤é™æ€å°é¢èƒŒæ™¯ â­ï¸
                stopSlideshow();
                videoWrapper.setAttribute('data-active', 'false');
            }
        }

        /* --- 2. ç”»å»Šå‡½æ•° (ç¼©ç•¥å›¾åˆ—è¡¨) --- */
        function renderVideoGallery() {
            videoList.forEach((video, index) => {
                const item = document.createElement('div');
                item.className = 'thumbnail-item';
                item.setAttribute('data-index', index);
                const img = document.createElement('img');
                img.src = video.thumbnail;
                img.alt = video.title;
                const title = document.createElement('p');
                title.textContent = video.title;
                item.appendChild(img);
                item.appendChild(title);
                item.addEventListener('click', () => {
                    playOverlay.style.display = 'flex'; 
                    loadAndPlay(index);
                });
                thumbnailListDiv.appendChild(item);
            });
        }
        function updateActiveThumbnail(activeIndex) {
            document.querySelectorAll('.thumbnail-item').forEach((item, index) => {
                item.classList.remove('active');
                if (index === activeIndex) {
                    item.classList.add('active');
                }
            });
        }

        /* --- 3. SHA-256 Utility (å“ˆå¸Œè®¡ç®—) --- */
        async function sha256(message) {
            const msgBuffer = new TextEncoder().encode(message);
            const hashBuffer = await crypto.subtle.digest('SHA-256', msgBuffer);
            const hashArray = Array.from(new Uint8Array(hashBuffer));
            const hashHex = hashArray.map(b => b.toString(16).padStart(2, '0')).join('');
            return hashHex;
        }

        /* --- 8. Utility: Fisher-Yates Shuffle (æ´—ç‰Œç®—æ³•) --- */
        function shuffleArray(array) {
            // éšæœºæ‰“ä¹±æ•°ç»„çš„é¡ºåºï¼ˆåœ¨åŸæ•°ç»„ä¸Šæ“ä½œï¼‰
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        /* --- 4. Passbook Loading (åŠ è½½éªŒè¯å“ˆå¸Œ) --- */
        async function loadPassbook() {
            if (cachedPassbook) {
                return cachedPassbook;
            }
            try {
                const response = await fetch(PASSBOOK_FILE_PATH);
                if (!response.ok) {
                    throw new Error(`Failed to load passbook: HTTP ${response.status}`);
                }
                const passbookText = await response.text();
                
                let cleanPassbook = passbookText.trim().toLowerCase();
                // ç§»é™¤å¤´éƒ¨æ··æ·†æ•°æ®
                if (cleanPassbook.length > PASSBOOK_HEADER_LENGTH) {
                    cleanPassbook = cleanPassbook.slice(PASSBOOK_HEADER_LENGTH);
                } 
                cachedPassbook = cleanPassbook; 
                return cachedPassbook;
            } catch (error) {
                console.error("[ERROR] Passbook loading failed:", error);
                modalMessage.textContent = "Verification system error.";
                throw error;
            }
        }

        /* --- 5. Download & Verification Logic (ä¸‹è½½å’ŒéªŒè¯) --- */
        function triggerFrontendDownload() {
            if (!currentVideoBlobURL) {
                alert("Error: Video file data not available.");
                return;
            }

            const a = document.createElement('a');
            a.href = currentVideoBlobURL;
            const videoTitle = videoList[currentVideoIndex].title.replace(/[^a-z0-9]/gi, '_'); 
            a.download = `${videoTitle}_Decrypted.mp4`;
            
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
        }

        async function handleModalVerification() {
            const inputToken = modalPasswordInput.value.trim();
            if (!inputToken) {
                modalMessage.textContent = "Please enter your access key.";
                return;
            }

            modalMessage.textContent = "Verifying...";
            modalVerifyBtn.disabled = true;

            try {
                const inputHash = await sha256(inputToken);
                const passbook = await loadPassbook();
                if (!passbook) { return; } 

                const accessGranted = passbook.includes(inputHash);

                if (accessGranted) {
                    modalMessage.textContent = "Success! Starting download...";
                    
                    setTimeout(() => {
                        downloadModal.style.display = 'none';
                        modalPasswordInput.value = '';
                        modalMessage.textContent = '';
                        triggerFrontendDownload(); 
                    }, 500);

                } else {
                    modalMessage.textContent = "Invalid key. Access denied.";
                }
            } catch (error) {
                modalMessage.textContent = "Verification error (check console).";
            } finally {
                modalVerifyBtn.disabled = false;
            }
        }

        /* --- 6. Initialization (åˆå§‹åŒ–æ’­æ”¾å™¨) --- */
        function initializeVideoPlayer() {
            if (typeof videojs !== 'undefined' && !videoPlayer) {
                videoPlayer = videojs(videoElement, {
                    controls: false, // åˆå§‹ç¦ç”¨åŸç”Ÿæ§åˆ¶æ¡
                    autoplay: false,
                    preload: 'auto',
                    fluid: true 
                });
                console.log("Video.js Player Initialized.");

                // ç¦ç”¨å³é”®å’Œæ‹–æ‹½ï¼Œé˜²æ­¢ç®€å•ä¸‹è½½
                videoPlayer.on('contextmenu', e => e.preventDefault());
                videoPlayer.el().addEventListener('dragstart', e => e.preventDefault());
            }
        }


        /* --- 7. Page Startup Binding (äº‹ä»¶ç»‘å®š) --- */
        document.addEventListener('DOMContentLoaded',async () => {
            // â­ï¸ ç­‰å¾…æ¸…å•æ–‡ä»¶åŠ è½½å®Œæ¯• â­ï¸
            await fetchSlideshowImages();
            renderVideoGallery();
            updateActiveThumbnail(0);
            
            // ç¡®ä¿ Video.js è„šæœ¬è¢«åŠ è½½ï¼Œå¹¶åˆå§‹åŒ–æ’­æ”¾å™¨
            loadVideoJsScript(initializeVideoPlayer);

            // ç»‘å®šå¼€å§‹æ’­æ”¾æŒ‰é’®
            startButton.addEventListener('click', () => {
                if (!startButton.disabled) {
                    // é»˜è®¤æ’­æ”¾ç¬¬ä¸€ä¸ªè§†é¢‘
                    loadAndPlay(0); 
                }
            });
            // ç»‘å®šè¦†ç›–å±‚ç‚¹å‡»äº‹ä»¶ï¼ˆç‚¹å‡»ä»»æ„å¤„æ’­æ”¾ï¼‰
            playOverlay.addEventListener('click', (e) => { 
                // ç¡®ä¿ç‚¹å‡»çš„ä¸æ˜¯æŒ‰é’®å’Œè¿›åº¦æ¡å®¹å™¨æœ¬èº«
                if (e.target.id === 'play-overlay' || e.target.id === 'video-wrapper') {
                    if (!startButton.disabled) { 
                        loadAndPlay(currentVideoIndex);
                    }
                }
            });

            // â­ï¸ æ ¸å¿ƒç»‘å®šï¼šæ‰‹åŠ¨å¯¼èˆªæŒ‰é’® â­ï¸
            prevSlideBtn.addEventListener('click', () => manualChangeSlide(-1));
            nextSlideBtn.addEventListener('click', () => manualChangeSlide(1));

            // ç»‘å®šæ¨¡æ€æ¡†äº‹ä»¶
            downloadVideoBtn.addEventListener('click', () => {
                if (currentVideoBlobURL) {
                    downloadModal.style.display = 'flex';
                    modalPasswordInput.focus();
                    if (videoPlayer) videoPlayer.pause(); 
                } else {
                    alert("Video data not loaded yet.");
                }
            });

            // é€Ÿåº¦æ§åˆ¶æ¡ç›‘å¬
            speedSlider.addEventListener('input', function() {
                const speedValue = parseInt(this.value, 10);
                
                // 1. æ›´æ–°ç•Œé¢æ˜¾ç¤º
                speedDisplay.textContent = speedValue + 's';

                // 2. é‡æ–°å¯åŠ¨æ»šåŠ¨å›¾åº“å®šæ—¶å™¨
                // åªæœ‰åœ¨å¹»ç¯ç‰‡æ­£åœ¨è¿è¡Œæ—¶ï¼ˆå³è§†é¢‘æ­£åœ¨åŠ è½½ï¼‰ï¼Œæ‰éœ€è¦æ›´æ–°é€Ÿåº¦
                if (slideshowWrapper.style.display === 'block') {
                    // æ¸…é™¤æ—§çš„å®šæ—¶å™¨
                    clearInterval(slideshowInterval);
                    
                    // å¯åŠ¨æ–°çš„å®šæ—¶å™¨ï¼Œä½¿ç”¨æ–°çš„é€Ÿåº¦å€¼
                    slideshowInterval = setInterval(nextSlide, speedValue * 1000);
                    console.log(`Slideshow speed updated to ${speedValue} seconds.`);
                }
            });
            modalVerifyBtn.addEventListener('click', handleModalVerification);
            modalPasswordInput.addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    handleModalVerification();
                }
            });
            downloadModal.addEventListener('click', (e) => {
                if (e.target === downloadModal) {
                    downloadModal.style.display = 'none';
                    modalPasswordInput.value = '';
                    modalMessage.textContent = '';
                }
            });
            
            // é¡µé¢åŠ è½½æ—¶ï¼Œç¡®ä¿åˆå§‹çŠ¶æ€æ­£ç¡®
            stopSlideshow(); // é»˜è®¤éšè—ä¸Šæ–¹çš„å›¾åº“
            videoWrapper.setAttribute('data-active', 'false'); // ç¡®ä¿é™æ€å°é¢å›¾æ˜¾ç¤º
        });
    </script>
    
</body>
</html>